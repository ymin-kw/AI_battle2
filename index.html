<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì°¸ê°€ ë“±ë¡ - AI Battle</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background: #050510; color: #fff; font-family: 'Noto Sans KR', sans-serif; padding: 20px; text-align: center; margin: 0; }
        .container { max-width: 500px; margin: 0 auto; padding-bottom: 50px; }
        
        h2 { color: #00f3ff; text-shadow: 0 0 10px #00f3ff; font-style: italic; margin-bottom: 30px; }
        
        .input-group { background: #1a1a2e; padding: 25px; border-radius: 20px; border: 1px solid #333; box-shadow: 0 0 20px rgba(0, 243, 255, 0.1); text-align: left; }
        
        label { display: block; color: #aaa; margin-top: 15px; font-size: 0.9em; font-weight: bold; }
        input, textarea { width: 100%; background: #0f0f1a; border: 1px solid #444; color: white; padding: 12px; border-radius: 8px; margin-top: 5px; font-size: 16px; box-sizing: border-box; }
        textarea { height: 80px; resize: none; }
        input:focus, textarea:focus { border-color: #00f3ff; outline: none; }
        
        button { width: 100%; padding: 15px; margin-top: 30px; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; 
                 background: linear-gradient(45deg, #00f3ff, #bc13fe); color: white; box-shadow: 0 0 15px rgba(188, 19, 254, 0.5); transition: 0.3s; }
        button:active { transform: scale(0.98); }
        
        /* ë“±ë¡ ì™„ë£Œ í›„ í™”ë©´ */
        .hidden { display: none; }
        .success-box { margin-top: 20px; padding: 20px; text-align: center; animation: fadeIn 0.5s; }
        .profile-img { width: 120px; height: 120px; border-radius: 50%; border: 4px solid #00f3ff; object-fit: cover; margin-bottom: 20px; box-shadow: 0 0 20px #00f3ff; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div class="container">
        <h2>âš¡ PLAYER REGISTER âš¡</h2>
        
        <div id="form-box" class="input-group">
            <label>ë‹‰ë„¤ì„</label>
            <input id="name" placeholder="ì˜ˆ: íŒŒì´ì¬ë§ˆìŠ¤í„°">
            
            <label>í•„ì‚´ê¸° ëª…</label>
            <input id="skill" placeholder="ì˜ˆ: ë¬´í•œ ë£¨í”„">
            
            <label>ê¸°ìˆ  ìƒì„¸ ì„¤ëª… (êµ¬ì²´ì ìœ¼ë¡œ)</label>
            <textarea id="skill_detail" placeholder="ì–´ë–¤ ì›ë¦¬ë¡œ ê³µê²©í•˜ë‚˜ìš”?"></textarea>
            
            <label>ì¹˜ëª…ì  ì•½ì </label>
            <textarea id="weakness" placeholder="ë¬´ì—‡ì— ì•½í•œê°€ìš”?"></textarea>
            
            <label>ìºë¦­í„° ì‚¬ì§„ (ì„ íƒ)</label>
            <input type="file" id="imgInput" accept="image/*" style="padding: 5px;">
            
            <button onclick="register()" id="regBtn">ì°¸ê°€ ì‹ ì²­</button>
        </div>

        <div id="success-box" class="success-box hidden">
            <h1 style="color:#0f0;">âœ… ë“±ë¡ ì™„ë£Œ!</h1>
            <img id="my-img" class="profile-img" src="">
            <h3 id="my-name"></h3>
            
            <div style="background:#111; padding:10px; border-radius:10px; margin-top:20px;">
                <p style="color:#aaa; font-size:0.9em;">AIê°€ ë¶„ì„í•œ ë‹¹ì‹ ì˜ ì „íˆ¬ë ¥</p>
                <canvas id="statChart"></canvas>
            </div>
            
            <p style="margin-top:30px; color:#aaa;">ì ì‹œ í›„ ë©”ì¸ í™”ë©´ì—ì„œ ê²½ê¸°ê°€ ì‹œì‘ë©ë‹ˆë‹¤.</p>
        </div>
    </div>

    <script>
        // ğŸš¨ [í•„ìˆ˜] Replit ì£¼ì†Œ ì…ë ¥ (ë§¨ ë’¤ ìŠ¬ë˜ì‹œ ë¹¼ê³ !)
        const SERVER_URL = "https://2370d655-4aef-4419-aefc-53bb80ee4dd1-00-2rwi6mcfrqjc2.sisko.replit.dev";

        let imgData = "";
        document.getElementById('imgInput').addEventListener('change', function() {
            const r = new FileReader();
            r.onload = function() { imgData = r.result; }
            if(this.files[0]) r.readAsDataURL(this.files[0]);
        });

        async function register() {
            const n = document.getElementById('name').value;
            const s = document.getElementById('skill').value;
            const d = document.getElementById('skill_detail').value;
            const w = document.getElementById('weakness').value;
            
            if(!n || !s) return alert("ì´ë¦„ê³¼ ê¸°ìˆ ì€ í•„ìˆ˜ì…ë‹ˆë‹¤!");
            
            const btn = document.getElementById('regBtn');
            btn.innerText = "AIê°€ ë¶„ì„ ì¤‘...";
            btn.disabled = true;

            try {
                const res = await fetch(`${SERVER_URL}/register`, {
                    method: 'POST', headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({name:n, skill:s, skill_detail:d, weakness:w, image:imgData})
                });
                
                if(res.ok) {
                    // ë‚´ ì •ë³´ ë‹¤ì‹œ ë°›ì•„ì˜¤ê¸° (ìŠ¤íƒ¯ í™•ì¸ìš©)
                    const all = await fetch(`${SERVER_URL}/participants`);
                    const list = await all.json();
                    const me = list[list.length - 1]; // ë°©ê¸ˆ ë“±ë¡í•œ ë‚˜

                    showSuccess(me);
                } else {
                    const err = await res.json();
                    alert("ì˜¤ë¥˜: " + err.detail);
                    btn.innerText = "ì°¸ê°€ ì‹ ì²­";
                    btn.disabled = false;
                }
            } catch(e) { 
                alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨! ì£¼ì†Œë¥¼ í™•ì¸í•˜ì„¸ìš”.");
                btn.innerText = "ì°¸ê°€ ì‹ ì²­";
                btn.disabled = false;
            }
        }

        function showSuccess(me) {
            document.getElementById('form-box').classList.add('hidden');
            const successBox = document.getElementById('success-box');
            successBox.classList.remove('hidden');
            
            document.getElementById('my-img').src = me.image;
            document.getElementById('my-name').innerText = me.name;

            // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            const ctx = document.getElementById('statChart').getContext('2d');
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['ê³µê²©ë ¥', 'ë°©ì–´ë ¥', 'ì†ë„', 'ì§€ëŠ¥', 'ë³€ìˆ˜ì°½ì¶œ'],
                    datasets: [{
                        label: 'ëŠ¥ë ¥ì¹˜',
                        data: [me.stats.PWR, me.stats.DEF, me.stats.SPD, me.stats.INT, me.stats.VAR],
                        backgroundColor: 'rgba(0, 243, 255, 0.2)',
                        borderColor: '#00f3ff',
                        borderWidth: 2,
                        pointBackgroundColor: '#fff'
                    }]
                },
                options: {
                    scales: { r: { min: 0, max: 100, ticks: { display: false }, grid: { color: '#333' }, pointLabels: { color: '#fff' } } },
                    plugins: { legend: { display: false } }
                }
            });
        }
    </script>
</body>
</html>
