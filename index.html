<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Live AI Tournament</title>
    <style>
        body { background: #111; color: white; font-family: 'Noto Sans KR', sans-serif; margin: 0; overflow-x: auto; padding: 20px; }
        
        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .control-panel { position: fixed; top: 0; left: 0; width: 100%; background: rgba(0,0,0,0.9); padding: 10px; z-index: 100; display: flex; gap: 10px; align-items: center; border-bottom: 1px solid #333;}
        input { padding: 8px; background: #333; border: 1px solid #555; color: white; width: 100px;}
        button { padding: 8px 15px; background: #e91e63; color: white; border: none; cursor: pointer; font-weight: bold; border-radius: 4px;}
        
        /* ëŒ€ì§„í‘œ ìŠ¤íƒ€ì¼ */
        .bracket { display: flex; padding: 20px; margin-top: 60px; width: max-content; }
        .round { display: flex; flex-direction: column; justify-content: space-around; margin-right: 50px; }
        .round-name { text-align: center; font-weight: bold; color: gold; margin-bottom: 10px; font-size: 1.2em;}
        
        .match { 
            width: 200px; background: #222; border: 1px solid #444; border-radius: 8px; 
            padding: 8px; margin: 10px 0; cursor: pointer; position: relative; transition: 0.2s;
        }
        .match:hover { border-color: #fff; transform: scale(1.05); }
        .match.done { border-color: gold; opacity: 0.8; }
        
        .player { display: flex; align-items: center; padding: 4px; font-size: 0.9em; height: 30px;}
        .p-img { width: 30px; height: 30px; border-radius: 50%; margin-right: 8px; object-fit: cover; border: 1px solid #555; }
        .win-text { color: gold; font-weight: bold; }
        .lose-text { color: #666; text-decoration: line-through; }

        /* ì—°ê²°ì„  */
        .match::after { content: ""; position: absolute; right: -25px; top: 50%; width: 25px; height: 2px; background: #444; }
        .round:last-child .match::after { display: none; }

        /* ğŸ¥Š [í•µì‹¬] ëŒ€í˜• ë°°í‹€ íŒì—… (Modal) ìŠ¤íƒ€ì¼ */
        #modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 999; align-items: center; justify-content: center; }
        .modal-box { background: #1a1a1a; width: 80%; max-width: 800px; padding: 30px; border-radius: 20px; border: 2px solid #444; text-align: center; position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        
        .vs-area { display: flex; justify-content: center; align-items: center; margin-bottom: 20px; gap: 20px; }
        .big-p { width: 150px; height: 150px; border-radius: 15px; object-fit: cover; border: 4px solid #555; transition: 0.5s; }
        .vs-text { font-size: 3em; font-weight: bold; font-style: italic; color: #ff4444; }
        
        .battle-log { background: #000; padding: 15px; border-radius: 10px; color: #0f0; font-family: monospace; text-align: left; min-height: 80px; white-space: pre-wrap; margin-bottom: 20px; line-height: 1.6; font-size: 1.1em;}
        
        .close-btn { background: gold; color: black; padding: 10px 40px; font-size: 1.2em; margin-top: 10px; }

        /* ìŠ¹ë¦¬ íš¨ê³¼ */
        .winner-effect { border-color: gold; box-shadow: 0 0 30px gold; transform: scale(1.2); z-index: 10; }
        .loser-effect { filter: grayscale(100%) brightness(0.3); transform: scale(0.8); }

    </style>
</head>
<body>

    <div class="control-panel">
        <h3>ğŸ† AI Battle Royale</h3>
        <input id="name" placeholder="ì´ë¦„">
        <input id="skill" placeholder="ê¸°ìˆ ">
        <input type="file" id="imgInput" accept="image/*" style="width:180px;">
        <button onclick="register()">ì°¸ê°€ ë“±ë¡</button>
        <span id="cnt" style="margin:0 10px; color:#0f0;">ëŒ€ê¸°: 0</span>
        <div style="flex-grow:1;"></div>
        <button onclick="initTournament()" style="background:gold; color:black;">ğŸ”¥ ëŒ€ì§„í‘œ ìƒì„± (ì‹œì‘)</button>
    </div>

    <div id="bracket-area" class="bracket">
        <div style="color:#666; margin: 100px;">
            <h2>ğŸ‘ˆ ìƒë‹¨ ë©”ë‰´ì—ì„œ ë“±ë¡ í›„ 'ëŒ€ì§„í‘œ ìƒì„±'ì„ ëˆ„ë¥´ì„¸ìš”.</h2>
        </div>
    </div>

    <div id="modal-overlay">
        <div class="modal-box">
            <h2 id="modal-title" style="color:gold; margin-bottom:20px;">BATTLE START!</h2>
            
            <div class="vs-area">
                <div>
                    <img id="p1-big-img" class="big-p" src="">
                    <h3 id="p1-big-name">Player 1</h3>
                </div>
                
                <div class="vs-text">VS</div>
                
                <div>
                    <img id="p2-big-img" class="big-p" src="">
                    <h3 id="p2-big-name">Player 2</h3>
                </div>
            </div>

            <div id="modal-log" class="battle-log">
                AI ì‹¬íŒì´ íŒì • ì¤‘ì…ë‹ˆë‹¤...
            </div>

            <button class="close-btn" onclick="closeModal()">ë‹«ê¸° (ê²°ê³¼ ë°˜ì˜)</button>
        </div>
    </div>

    <script>
        // ğŸš¨ Replit ì£¼ì†Œ ì…ë ¥ (ìŠ¬ë˜ì‹œ X)
        const SERVER_URL = "https://2370d655-4aef-4419-aefc-53bb80ee4dd1-00-2rwi6mcfrqjc2.sisko.replit.dev";

        let selectedImage = "";
        document.getElementById('imgInput').addEventListener('change', function() {
            const reader = new FileReader();
            reader.onloadend = function() { selectedImage = reader.result; }
            if(this.files[0]) reader.readAsDataURL(this.files[0]);
        });

        async function register() {
            const n = document.getElementById('name').value;
            const s = document.getElementById('skill').value;
            // ì´ë¯¸ì§€ ì—†ìœ¼ë©´ ëª¨í—˜ê°€ ì•„ë°”íƒ€ ìë™
            let img = selectedImage || `https://api.dicebear.com/9.x/adventurer/svg?seed=${n}`;
            
            if(!n) return alert("ì´ë¦„ ì…ë ¥!");
            await fetch(`${SERVER_URL}/register`, {
                method: 'POST', headers: {'Content-Type':'application/json'},
                body: JSON.stringify({name:n, skill:s, image:img})
            });
            alert("ë“±ë¡ë¨");
            document.getElementById('name').value="";
            updateCnt();
        }

        async function updateCnt() {
            try {
                const res = await fetch(`${SERVER_URL}/participants`);
                const list = await res.json();
                document.getElementById('cnt').innerText = `ëŒ€ê¸°: ${list.length}`;
            } catch(e){}
        }
        setInterval(updateCnt, 2000);

        async function initTournament() {
            if(!confirm("32ê°• ëŒ€ì§„í‘œë¥¼ ìƒì„±í•©ë‹ˆë‹¤. (ë¶€ì¡±í•˜ë©´ ë´‡ ì±„ì›€)")) return;
            const res = await fetch(`${SERVER_URL}/init_tournament`, {method:'POST'});
            const data = await res.json();
            renderBracket(data.state);
        }

        // ê²½ê¸° í´ë¦­ -> íŒì—… ì—´ê¸° -> ê²°ê³¼ ê°€ì ¸ì˜¤ê¸°
        async function playMatch(rIdx, mIdx, p1Name, p1Img, p2Name, p2Img) {
            // 1. íŒì—… ì—´ê¸° ë° ì´ˆê¸°í™” (ë¡œë”© ìƒíƒœ)
            const overlay = document.getElementById('modal-overlay');
            overlay.style.display = 'flex';
            
            document.getElementById('modal-title').innerText = "âš”ï¸ ê²©ëŒ! âš”ï¸";
            document.getElementById('modal-log').innerText = "â³ AI ì‹¬íŒì´ ë‘ ìºë¦­í„°ì˜ ëŠ¥ë ¥ì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...";
            
            // ì´ë¯¸ì§€ ì„¸íŒ…
            const img1 = document.getElementById('p1-big-img');
            const img2 = document.getElementById('p2-big-img');
            img1.src = p1Img; img2.src = p2Img;
            document.getElementById('p1-big-name').innerText = p1Name;
            document.getElementById('p2-big-name').innerText = p2Name;
            
            // íš¨ê³¼ ì´ˆê¸°í™”
            img1.className = "big-p";
            img2.className = "big-p";

            try {
                // 2. ì„œë²„ì— íŒì • ìš”ì²­
                const res = await fetch(`${SERVER_URL}/play_match`, {
                    method: 'POST', headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({round_index: rIdx, match_index: mIdx})
                });
                const data = await res.json();
                const match = data.match;

                // 3. ê²°ê³¼ ì—°ì¶œ
                document.getElementById('modal-log').innerText = match.log;
                document.getElementById('modal-title').innerText = `ğŸ† ${match.winner.name} ìŠ¹ë¦¬!`;

                // ìŠ¹ì/íŒ¨ì ì‹œê° íš¨ê³¼
                if (match.winner.name === p1Name) {
                    img1.classList.add("winner-effect");
                    img2.classList.add("loser-effect");
                } else {
                    img2.classList.add("winner-effect");
                    img1.classList.add("loser-effect");
                }
                
                // ë°±ê·¸ë¼ìš´ë“œ ë°ì´í„° ê°±ì‹  (ë‹«ì„ ë•Œ ë°˜ì˜ë¨)
                refreshState();

            } catch(e) { alert("ì˜¤ë¥˜ ë°œìƒ"); closeModal(); }
        }

        function closeModal() {
            document.getElementById('modal-overlay').style.display = 'none';
        }

        async function refreshState() {
            const res = await fetch(`${SERVER_URL}/state`);
            const state = await res.json();
            renderBracket(state);
        }

        function renderBracket(state) {
            const area = document.getElementById('bracket-area');
            area.innerHTML = "";

            state.rounds.forEach((round, rIdx) => {
                const col = document.createElement('div');
                col.className = 'round';
                
                const title = document.createElement('div');
                title.className = 'round-name';
                title.innerText = rIdx === 4 ? "ğŸ‘‘ ê²°ìŠ¹" : `${Math.pow(2, 5-rIdx)}ê°•`;
                col.appendChild(title);

                round.forEach((match, mIdx) => {
                    const box = document.createElement('div');
                    box.className = `match ${match.winner ? 'done' : ''}`;
                    
                    // ì„ ìˆ˜ ì •ë³´ê°€ ë‘˜ ë‹¤ ìˆì„ ë•Œë§Œ í´ë¦­ ê°€ëŠ¥
                    if (!match.winner && match.p1 && match.p2) {
                        box.onclick = () => playMatch(rIdx, mIdx, match.p1.name, match.p1.image, match.p2.name, match.p2.image);
                        box.style.borderColor = "#0f0"; 
                        box.title = "í´ë¦­í•˜ì—¬ ë°°í‹€ ì‹œì‘!";
                    }

                    const drawP = (p, isWinner) => {
                        if (!p) return `<div class="player">???</div>`;
                        const cls = isWinner ? "win-text" : (match.winner ? "lose-text" : "");
                        return `<div class="player ${cls}">
                                    <img src="${p.image}" class="p-img"> ${p.name}
                                </div>`;
                    };

                    const isP1Win = match.winner && match.winner.name === match.p1.name;
                    const isP2Win = match.winner && match.p2 && match.winner.name === match.p2.name;

                    box.innerHTML = drawP(match.p1, isP1Win) + drawP(match.p2, isP2Win);
                    col.appendChild(box);
                });
                area.appendChild(col);
            });
        }
    </script>
</body>
</html>



<!-- <!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>AI ë°°í‹€ ë¡œì–„ (32ê°• ëŒ€ì§„í‘œ)</title>
    <style>
        body { background: #1a1a1a; color: white; font-family: 'Noto Sans KR', sans-serif; margin: 0; overflow-x: auto; }
        .header { text-align: center; padding: 20px; position: sticky; top: 0; background: #1a1a1a; z-index: 100; border-bottom: 1px solid #444; }
        
        /* ì…ë ¥ì°½ ë””ìì¸ */
        .input-group { display: inline-block; background: #333; padding: 10px; border-radius: 10px; }
        input, textarea { background: #222; border: 1px solid #555; color: white; padding: 8px; border-radius: 4px; margin: 2px; width: 150px;}
        textarea { width: 300px; height: 40px; vertical-align: middle; }
        button { background: gold; border: none; padding: 8px 15px; font-weight: bold; cursor: pointer; border-radius: 4px; }
        
        /* ëŒ€ì§„í‘œ ë ˆì´ì•„ì›ƒ (Flexbox) */
        .bracket-container { display: flex; padding: 40px; min-width: 1200px; justify-content: center; }
        .round-column { display: flex; flex-direction: column; justify-content: space-around; margin: 0 20px; position: relative; }
        .round-title { text-align: center; font-weight: bold; color: #aaa; margin-bottom: 20px; font-size: 1.2em; }
        
        /* ê²½ê¸° ë°•ìŠ¤ */
        .match-box { 
            width: 200px; background: #2a2a2a; border: 1px solid #444; border-radius: 8px; 
            padding: 10px; margin: 10px 0; position: relative; transition: 0.3s;
        }
        .match-box:hover { border-color: gold; transform: scale(1.05); z-index: 10; }
        .match-box::after { /* ì—°ê²°ì„  */
            content: ""; position: absolute; right: -22px; top: 50%; width: 20px; height: 2px; background: #555;
        }
        .round-column:last-child .match-box::after { display: none; } /* ê²°ìŠ¹ì „ì€ ì„  ì—†ìŒ */

        .player-row { display: flex; align-items: center; margin: 4px 0; font-size: 0.9em; }
        .p-img { width: 25px; height: 25px; border-radius: 50%; margin-right: 5px; border: 1px solid #555; }
        .winner-row { color: gold; font-weight: bold; text-shadow: 0 0 5px rgba(255,215,0,0.5); }
        .loser-row { color: #666; text-decoration: line-through; }
        
        /* ë¡œë”©/ê²°ê³¼ì°½ */
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 200; align-items: center; justify-content: center; flex-direction: column; }
        #overlay-text { font-size: 2em; color: gold; margin-bottom: 20px; text-align: center; white-space: pre-wrap;}
        .big-img { width: 200px; height: 200px; border-radius: 50%; border: 5px solid gold; box-shadow: 0 0 30px gold; }
        .close-btn { margin-top: 30px; padding: 10px 30px; font-size: 1.2em; background: white; }
    </style>
</head>
<body>
    <div class="header">
        <h2>ğŸ† AI ë°°í‹€ ë¡œì–„ (32ê°• í† ë„ˆë¨¼íŠ¸)</h2>
        
        <div class="input-group" id="reg-box">
            <input type="text" id="name" placeholder="ë‹‰ë„¤ì„">
            <input type="text" id="skill" placeholder="í•„ì‚´ê¸° (ì§§ê²Œ)">
            <textarea id="detail" placeholder="ì„¤ì •/ì•½ì  (ê¸¸ê²Œ)"></textarea>
            <input type="file" id="imgInput" accept="image/*" style="width:180px;">
            <button onclick="register()">ë“±ë¡</button>
        </div>
        
        <div style="margin-top:10px;">
            <span id="status" style="color:#0f0; margin-right:20px;">ëŒ€ê¸°ì‹¤: 0ëª…</span>
            <button onclick="startTournament()" style="background:#ff4444; color:white;">ğŸ”¥ ëŒ€ì§„í‘œ ìƒì„± ë° ì‹œì‘ (32ëª… ìë™ ì±„ì›€)</button>
        </div>
    </div>

    <div class="bracket-container" id="bracket">
        <div style="color:#666; margin-top:50px;">ì°¸ê°€ìê°€ ë“±ë¡ë˜ë©´ ì—¬ê¸°ì— ëŒ€ì§„í‘œê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤...</div>
    </div>

    <div id="overlay">
        <div id="overlay-text"></div>
        <div id="overlay-content"></div>
        <button class="close-btn" onclick="closeOverlay()">ë‹«ê¸°</button>
    </div>

    <script>
        // ğŸš¨ ì£¼ì†Œ ì…ë ¥ 
        const SERVER_URL = "https://2370d655-4aef-4419-aefc-53bb80ee4dd1-00-2rwi6mcfrqjc2.sisko.replit.dev";

        let selectedImageBase64 = "";
        document.getElementById('imgInput').addEventListener('change', function() {
            const reader = new FileReader();
            reader.onloadend = function() { selectedImageBase64 = reader.result; }
            if(this.files[0]) reader.readAsDataURL(this.files[0]);
        });

        // ë“±ë¡
        async function register() {
            const name = document.getElementById('name').value;
            const skill = document.getElementById('skill').value;
            const detail = document.getElementById('detail').value;
            let img = selectedImageBase64 || `https://api.dicebear.com/9.x/adventurer/svg?seed=${name}`;

            if(!name) return alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!");

            try {
                await fetch(`${SERVER_URL}/register`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({name, skill, skill_detail: detail, weakness: detail, image: img})
                });
                alert("ë“±ë¡ ì™„ë£Œ!");
                document.getElementById('name').value = "";
                updateCount();
            } catch(e) { alert("ë“±ë¡ ì‹¤íŒ¨"); }
        }

        async function updateCount() {
            try {
                const res = await fetch(`${SERVER_URL}/participants`);
                const list = await res.json();
                document.getElementById('status').innerText = `ëŒ€ê¸°ì‹¤: ${list.length}ëª…`;
            } catch(e) {}
        }
        setInterval(updateCount, 2000);

        // í† ë„ˆë¨¼íŠ¸ ì‹œì‘ ë° ê·¸ë¦¬ê¸°
        async function startTournament() {
            const overlay = document.getElementById('overlay');
            const oText = document.getElementById('overlay-text');
            overlay.style.display = 'flex';
            oText.innerText = "â³ AIê°€ 32ëª…ì˜ ìš´ëª…ì„ ê³„ì‚° ì¤‘ì…ë‹ˆë‹¤...\n(ë¹ˆìë¦¬ëŠ” ë´‡ìœ¼ë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤)";
            document.getElementById('overlay-content').innerHTML = "";

            try {
                const res = await fetch(`${SERVER_URL}/tournament`, { method: 'POST' });
                const data = await res.json();
                
                renderBracket(data.history); // ëŒ€ì§„í‘œ ê·¸ë¦¬ê¸° í•¨ìˆ˜ í˜¸ì¶œ
                
                // ìš°ìŠ¹ì ë°œí‘œ
                oText.innerText = `ğŸ‘‘ ìµœì¢… ìš°ìŠ¹: ${data.final_winner.name} ğŸ‘‘`;
                document.getElementById('overlay-content').innerHTML = `
                    <img src="${data.final_winner.image}" class="big-img">
                    <p style="color:white; font-size:1.2em;">${data.final_winner.skill}</p>
                `;

            } catch(e) {
                oText.innerText = "ì—ëŸ¬ ë°œìƒ! ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.";
            }
        }

        function closeOverlay() {
            document.getElementById('overlay').style.display = 'none';
        }

        // [í•µì‹¬] ëŒ€ì§„í‘œ ê·¸ë¦¬ê¸° í•¨ìˆ˜
        function renderBracket(history) {
            const container = document.getElementById('bracket');
            container.innerHTML = "";

            history.forEach((round, rIndex) => {
                const col = document.createElement('div');
                col.className = 'round-column';
                
                // ë¼ìš´ë“œ ì´ë¦„ (32ê°•, 16ê°•...)
                let roundName = "";
                if (rIndex === 0) roundName = "32ê°•";
                else if (rIndex === 1) roundName = "16ê°•";
                else if (rIndex === 2) roundName = "8ê°•";
                else if (rIndex === 3) roundName = "4ê°•";
                else if (rIndex === 4) roundName = "ê²°ìŠ¹";
                
                col.innerHTML = `<div class="round-title">${roundName}</div>`;

                round.matches.forEach(m => {
                    const box = document.createElement('div');
                    box.className = 'match-box';
                    
                    // p1, p2 ê·¸ë¦¬ê¸°
                    const p1Class = m.winner === m.p1.name ? "winner-row" : "loser-row";
                    const p2Class = m.winner === m.p2.name ? "winner-row" : "loser-row";
                    
                    box.innerHTML = `
                        <div class="player-row ${p1Class}" title="${m.log}">
                            <img src="${m.p1.image}" class="p-img">${m.p1.name}
                        </div>
                        <div class="player-row ${p2Class}" title="${m.log}">
                            <img src="${m.p2.image}" class="p-img">${m.p2.name}
                        </div>
                    `;
                    // í´ë¦­í•˜ë©´ ë¡œê·¸ ë³´ê¸°
                    box.onclick = () => alert(`[ì „íˆ¬ ë¡œê·¸]\n\n${m.log}\n\nğŸ‘‰ìŠ¹ë¦¬ìš”ì¸: ${m.reason}`);
                    col.appendChild(box);
                });

                container.appendChild(col);
            });
            
            // ìµœì¢… ìš°ìŠ¹ì ì»¬ëŸ¼ ì¶”ê°€
            const winnerCol = document.createElement('div');
            winnerCol.className = 'round-column';
            winnerCol.innerHTML = `<div class="round-title">ìš°ìŠ¹</div><div class="match-box" style="border-color:gold; color:gold; font-weight:bold; text-align:center;">ğŸ‘‘ CHAMP ğŸ‘‘</div>`;
            container.appendChild(winnerCol);
        }
    </script>
</body>
</html> -->
